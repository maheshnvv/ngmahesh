<!-- Demo Application for NgOsmMap Library -->

<header class="header">
  <div class="container">
    <div class="header-nav">
      <a routerLink="/" class="back-link">← Back to Homepage</a>
    </div>
    <h1>🗺️ NgOsmMap Demo</h1>
    <p>Angular 18+ OpenStreetMap integration with Leaflet</p>
  </div>
</header>

<main class="main">
  <div class="container">

    <!-- External Search Input -->
    <section class="search-section">
      <h2>External Search with Autocomplete</h2>
      <div class="search-wrapper">
        <input
          type="text"
          ngOsmSearchInput
          [connectedMapId]="mapId"
          [enableAutocomplete]="true"
          [showSuggestionsDropdown]="true"
          placeholder="Search locations... (try typing 'New York')"
          class="search-input"
          (search)="onSearchInputSearch($event)"
          (suggestionSelected)="onSearchInputSuggestionSelected($event)"
          (autocompleteResults)="onSearchInputAutocompleteResults($event)">
        <p class="search-note">This input uses the ngOsmSearchInput directive and shows autocomplete suggestions</p>
        <p class="search-note">💡 When you search and then drag the search result pin, this input will update automatically!</p>
        <p class="search-note">📍 Click on the map to select locations. Use the Multi Select button to enable multiple selections.</p>
        <p class="search-note">🔍 Search results always use single selection, regardless of multi-select mode.</p>
        <p class="search-note">🗑️ Click on pins to see their details and delete them individually using the delete button in the popup.</p>
        <p class="search-note">🎯 This directive-based search input is independent of the map's readonly mode and will always function.</p>
      </div>
    </section>

    <!-- Search Input Directive Demo -->
    <section class="search-input-demo">
      <h2>🔍 Search Input Directive Demo</h2>
      <p>Using the <code>ngOsmSearchInput</code> directive to connect external search inputs to maps:</p>

      <!-- Documentation Link -->
      <div class="docs-link-section">
        <div class="docs-link-card">
          <div class="docs-icon">📚</div>
          <div class="docs-content">
            <h3>Complete API Documentation</h3>
            <p>For comprehensive documentation including all available options, properties, events, and usage examples for <code>NgOsmMapComponent</code>, <code>NgOsmMapDirective</code>, and <code>NgOsmSearchInputDirective</code>:</p>
            <a routerLink="/docs/ng-osm-map" class="docs-link-button">
              📖 View Full Documentation →
            </a>
          </div>
        </div>
      </div>

      <!-- Basic Examples -->
      <div class="demo-subsection">
        <h3>🚀 Basic Search Input</h3>
        <p>A minimal search input connected to the main map:</p>
        <div class="search-container">
          <input
            type="text"
            ngOsmSearchInput
            [connectedMapId]="mapId"
            [enableAutocomplete]="true"
            [showSuggestionsDropdown]="true"
            placeholder="Search for a location..."
            class="search-input"
            (search)="onSearchInputSearch($event)"
            (suggestionSelected)="onSearchInputSuggestionSelected($event)"
            (autocompleteResults)="onSearchInputAutocompleteResults($event)">
        </div>
      </div>

      <!-- Advanced Configuration -->
      <div class="demo-subsection">
        <h3>⚙️ Advanced Configuration</h3>
        <p>Search input with custom debounce, max results, and minimum query length:</p>
        <div class="search-container">
          <input
            type="text"
            ngOsmSearchInput
            [connectedMapId]="mapId"
            [enableAutocomplete]="true"
            [showSuggestionsDropdown]="true"
            [debounceMs]="500"
            [maxResults]="3"
            [minQueryLength]="3"
            placeholder="Advanced search (min 3 chars, 500ms delay)..."
            class="search-input"
            (search)="onSearchInputSearch($event)">
        </div>
      </div>

      <!-- Custom Template -->
      <div class="demo-subsection">
        <h3>🎨 Custom Template Search Input</h3>
        <p>Search input with custom template for autocomplete suggestions:</p>
        <div class="search-container">
          <input
            type="text"
            ngOsmSearchInput
            [connectedMapId]="mapId"
            [enableAutocomplete]="true"
            [customSearchTemplate]="customAutocompleteTemplate"
            placeholder="Search with custom template..."
            class="search-input"
            (search)="onSearchInputSearch($event)"
            (suggestionSelected)="onSearchInputSuggestionSelected($event)">
        </div>
      </div>

      <!-- Multiple Search Inputs -->
      <div class="demo-subsection">
        <h3>🔄 Multiple Search Inputs</h3>
        <p>Multiple search inputs connected to the same map with different configurations:</p>
        <div class="multi-search-container">
          <input
            type="text"
            ngOsmSearchInput
            [connectedMapId]="mapId"
            [enableAutocomplete]="true"
            [showSuggestionsDropdown]="true"
            [debounceMs]="150"
            [maxResults]="8"
            placeholder="Fast search (150ms delay, 8 results)..."
            class="search-input small"
            (search)="onSearchInputSearch($event)">

          <input
            type="text"
            ngOsmSearchInput
            [connectedMapId]="mapId"
            [enableAutocomplete]="true"
            [showSuggestionsDropdown]="true"
            [debounceMs]="800"
            [maxResults]="3"
            [minQueryLength]="4"
            placeholder="Slow search (800ms delay, 3 results, min 4 chars)..."
            class="search-input small"
            (search)="onSearchInputSearch($event)">
        </div>
      </div>

      <!-- Search Event Log -->
      <div class="demo-subsection">
        <h3>📊 Live Search Event Log</h3>
        <div class="event-log">
          <div *ngFor="let event of searchEventLog.slice(0, 10)" class="event-item">
            <strong>{{ event.type }}:</strong> {{ event.message }}
            <small>{{ event.timestamp | date:'HH:mm:ss' }}</small>
          </div>
          <div *ngIf="searchEventLog.length === 0" class="no-events">
            No search events yet. Try using the search inputs above!
          </div>
          <div *ngIf="searchEventLog.length > 10" class="more-events">
            ... and {{ searchEventLog.length - 10 }} more events
          </div>
        </div>
      </div>
    </section>

    <!-- Map Controls (Combined) -->
    <section class="map-controls-combined">
      <h2>🎮 Map Controls</h2>
      <div class="controls-grid">

        <!-- Basic Map Controls -->
        <div class="control-group">
          <h3>📍 Pin & Navigation</h3>
          <div class="button-group">
            <button class="btn btn-primary" (click)="addRandomPin()">
              📍 Add Random Pin
            </button>
            <button class="btn btn-primary" (click)="addSinglePin()">
              🏙️ Add City Pin
            </button>
            <button class="btn btn-secondary" (click)="clearPins()">
              🧹 Clear Pins
            </button>
            <button class="btn btn-info" (click)="zoomToNewYork()">
              🏙️ Zoom to NYC
            </button>
            <button class="btn btn-success" (click)="zoomToWorld()">
              🌍 World View
            </button>
            <button class="btn btn-warning" (click)="movePinToLondon()" [disabled]="pins.length === 0">
              🇬🇧 Move Pin to London
            </button>
          </div>
          <p class="pin-count">Current pins: {{ pins.length }}</p>
        </div>

        <!-- Selection Controls -->
        <div class="control-group">
          <h3>🎯 Selection</h3>
          <div class="button-group">
            <button class="btn btn-success" (click)="toggleMultiSelect()">
              {{ isMultiSelectEnabled() ? '📍 Single Select' : '📍 Multi Select' }}
            </button>
            <button class="btn btn-info" (click)="clearSelections()">
              🧹 Clear Selections
            </button>
          </div>
          <div class="button-group">
            <button class="btn"
                    [class.btn-primary]="autoZoomToSelection"
                    [class.btn-outline-primary]="!autoZoomToSelection"
                    (click)="toggleAutoZoomToSelection()">
              {{ autoZoomToSelection ? '🔍 Auto Zoom ON' : '🔍 Auto Zoom OFF' }}
            </button>
            <button class="btn btn-secondary"
                    (click)="manualZoomToFirstSelection()"
                    [disabled]="selectedLocations.length === 0">
              🎯 Zoom to First
            </button>
          </div>
          <div class="zoom-level-control" *ngIf="autoZoomToSelection">
            <label for="zoomLevel">Zoom Level ({{ autoZoomLevel }}):</label>
            <input type="range"
                   id="zoomLevel"
                   min="10"
                   max="18"
                   step="1"
                   [value]="autoZoomLevel"
                   (input)="onZoomLevelChange($event)"
                   class="zoom-slider">
          </div>
          <div class="animation-control" *ngIf="autoZoomToSelection">
            <button class="btn btn-sm"
                    [class.btn-success]="isAnimatedZoomEnabled()"
                    [class.btn-outline-success]="!isAnimatedZoomEnabled()"
                    (click)="toggleAnimatedZoom()">
              {{ isAnimatedZoomEnabled() ? '🎬 Animated' : '⚡ Instant' }} Zoom
            </button>
          </div>
          <p class="selection-mode-info">{{ getSelectionModeDescription() }}</p>
          <p class="auto-zoom-info">{{ getAutoZoomDescription() }}</p>
        </div>

        <!-- Pre-selection Controls -->
        <div class="control-group">
          <h3>🎯 Pre-Selection</h3>
          <div class="button-group">
            <button class="btn btn-primary" (click)="setPreSelectedLocation('New York City')">
              🗽 NYC
            </button>
            <button class="btn btn-primary" (click)="setPreSelectedLocation('London')">
              🇬🇧 London
            </button>
            <button class="btn btn-primary" (click)="setPreSelectedLocation('Tokyo')">
              🇯🇵 Tokyo
            </button>
            <button class="btn btn-success" (click)="setMultiplePreSelectedLocations()">
              🌍 Multiple
            </button>
            <button class="btn btn-secondary" (click)="clearPreSelectedLocations()">
              🧹 Clear
            </button>
          </div>
          <p class="pre-selection-info">
            Pre-selections: {{ selectedLocations.length }}
            <span *ngIf="selectedLocations.length > 0">
              ({{ getPreSelectedLocationNames() }})
            </span>
          </p>
        </div>

        <!-- Mode & Settings Controls -->
        <div class="control-group">
          <h3>⚙️ Mode & Settings</h3>
          <div class="button-group">
            <button class="btn"
                    [class.btn-success]="!isReadonlyMode()"
                    [class.btn-warning]="isReadonlyMode()"
                    (click)="toggleReadonlyMode()">
              {{ isReadonlyMode() ? '🔓 Enable' : '🔒 Readonly' }}
            </button>
            <button class="btn btn-secondary" (click)="testTemplatePopups()">
              🧩 Templates
            </button>
            <button class="btn btn-outline-secondary" (click)="clearCache()">
              🗑️ Clear Cache
            </button>
          </div>
          <div *ngIf="isReadonlyMode()" class="mt-2">
            <button class="btn btn-sm"
                    [class.btn-info]="isScrollInReadonlyEnabled()"
                    [class.btn-outline-secondary]="!isScrollInReadonlyEnabled()"
                    (click)="toggleScrollInReadonlyMode()">
              {{ isScrollInReadonlyEnabled() ? '🖱️ Scroll Zoom Enabled' : '🖱️ Enable Scroll Zoom' }}
            </button>
          </div>
          <p class="readonly-info">
            <strong>Mode:</strong> {{ isReadonlyMode() ? 'Readonly (interactions disabled)' : 'Interactive' }}
            <span *ngIf="isReadonlyMode() && isScrollInReadonlyEnabled()" class="badge bg-info text-white ms-2">
              Scroll Zoom Allowed
            </span>
          </p>
        </div>

        <!-- Boundary Controls -->
        <div class="control-group">
          <h3>🌍 Map Boundaries</h3>
          <div class="boundary-modes">
            <label class="radio-label">
              <input type="radio"
                     name="boundaryMode"
                     value="none"
                     [checked]="boundaryMode === 'none'"
                     (change)="setBoundaryMode('none')">
              <span>🌐 No Restrictions</span>
            </label>
            <label class="radio-label">
              <input type="radio"
                     name="boundaryMode"
                     value="world"
                     [checked]="boundaryMode === 'world'"
                     (change)="setBoundaryMode('world')">
              <span>🌎 World Bounds</span>
            </label>
            <label class="radio-label">
              <input type="radio"
                     name="boundaryMode"
                     value="custom"
                     [checked]="boundaryMode === 'custom'"
                     (change)="setBoundaryMode('custom')">
              <span>📍 Custom Bounds</span>
            </label>
          </div>

          <div class="boundary-presets" *ngIf="boundaryMode === 'custom'">
            <h4>Quick Presets:</h4>
            <div class="preset-buttons">
              <button *ngFor="let preset of boundaryPresets"
                      class="btn btn-sm btn-outline-primary"
                      (click)="setBoundaryPreset(preset)">
                {{ preset.name }}
              </button>
            </div>

            <h4>Custom Bounds:</h4>
            <div class="custom-bounds-inputs">
              <div class="bounds-row">
                <label>North-East:</label>
                <input type="number"
                       [value]="customBounds.northEast.lat"
                       (input)="onBoundInputChange($event, 'northEast.lat')"
                       placeholder="Latitude"
                       step="0.1"
                       min="-90"
                       max="90">
                <input type="number"
                       [value]="customBounds.northEast.lng"
                       (input)="onBoundInputChange($event, 'northEast.lng')"
                       placeholder="Longitude"
                       step="0.1"
                       min="-180"
                       max="180">
              </div>
              <div class="bounds-row">
                <label>South-West:</label>
                <input type="number"
                       [value]="customBounds.southWest.lat"
                       (input)="onBoundInputChange($event, 'southWest.lat')"
                       placeholder="Latitude"
                       step="0.1"
                       min="-90"
                       max="90">
                <input type="number"
                       [value]="customBounds.southWest.lng"
                       (input)="onBoundInputChange($event, 'southWest.lng')"
                       placeholder="Longitude"
                       step="0.1"
                       min="-180"
                       max="180">
              </div>
            </div>
          </div>

          <div class="no-wrap-control">
            <label class="checkbox-label">
              <input type="checkbox"
                     [checked]="noWrapEnabled"
                     (change)="toggleNoWrap()">
              <span>🚫 Disable World Wrapping</span>
            </label>
          </div>

          <div class="boundary-info">
            <p><strong>Boundaries:</strong> {{ getBoundaryDescription() }}</p>
            <p><strong>Wrapping:</strong> {{ getNoWrapDescription() }}</p>
          </div>
        </div>

        <!-- Tile Layer Controls -->
        <div class="control-group">
          <h3>🗺️ Map Layers</h3>
          <p class="current-layer">Current: <strong>{{ getCurrentTileLayerName() }}</strong></p>
          <div class="layer-buttons">
            <button
              *ngFor="let layer of tileLayerOptions"
              class="btn btn-layer"
              [class.active]="currentTileLayer === layer.type"
              (click)="switchTileLayer(layer.type)"
              [title]="layer.description">
              {{ layer.name }}
            </button>
          </div>
        </div>

      </div>
    </section>

    <!-- Interactive Map with All Features -->
    <section class="map-section">
      <h2>Interactive Map with All Features</h2>
      <ng-osm-map
        #mapComponent
        [mapId]="mapId"
        [pins]="pins"
        [zoomInto]="centerLocation"
        [highlightAreas]="highlightAreas"
        [mapOptions]="mapOptions"
        [height]="400"
        [width]="'100%'"
        (mapClick)="onMapClick($event)"
        (locationSelected)="onLocationSelected($event)"
        (searchResult)="onSearchResult($event)"
        (pinDragged)="onPinDragged($event)"
        (autocompleteResults)="onAutocompleteResults($event)"
        (pinDeleted)="onPinDeleted($event)"
        (selectionChanged)="onSelectionChanged($event)"
        class="map-container">
      </ng-osm-map>
    </section>

    <!-- Event Information Panels -->
    <section class="info-panels">
      <h2>Live Event Information</h2>
      <div class="panel-grid">

        <!-- Click Events -->
        <div class="info-panel">
          <h3>🖱️ Click Events</h3>
          <div class="info-content">
            <h4>Last Selected Location:</h4>
            <pre>{{ getSelectedLocationInfo() }}</pre>
            <div class="pin-tracker" *ngIf="selectedLocationPinIndex >= 0 && pins[selectedLocationPinIndex]">
              <small>🔗 Tracked pin: #{{ selectedLocationPinIndex + 1 }} ({{ pins[selectedLocationPinIndex].title || 'Selected Location' }})</small>
            </div>

            <h4>Click History (last 5):</h4>
            <div class="history-list" *ngFor="let click of clickHistory; let i = index">
              <small>{{ i + 1 }}. Lat: {{ click.coordinates.latitude.toFixed(4) }},
                Lng: {{ click.coordinates.longitude.toFixed(4) }}
                <ng-container *ngIf="getTruncatedAddress(click.addressInfo)"> - {{ getTruncatedAddress(click.addressInfo) }}</ng-container>
              </small>
            </div>
          </div>
        </div>

        <!-- Search Events -->
        <div class="info-panel">
          <h3>🔍 Search Events</h3>
          <div class="info-content">
            <h4>Last Search Result:</h4>
            <pre>{{ getSearchResultInfo() }}</pre>
            <div class="pin-tracker" *ngIf="searchResultPinIndex >= 0 && pins[searchResultPinIndex]">
              <small>🔗 Tracked pin: #{{ searchResultPinIndex + 1 }} ({{ pins[searchResultPinIndex].title || 'Search Result' }})</small>
            </div>

            <h4>Autocomplete Suggestions:</h4>
            <div class="history-list" *ngFor="let suggestion of autocompleteHistory; let i = index">
              <small>{{ i + 1 }}. {{ suggestion.displayText }}</small>
            </div>
          </div>
        </div>

        <!-- Drag Events -->
        <div class="info-panel">
          <h3>🔄 Pin Drag Events</h3>
          <div class="info-content">
            <h4>Last Dragged Pin:</h4>
            <pre>{{ getDragHistoryInfo() }}</pre>

            <h4>Drag History (last 5):</h4>
            <div class="history-list" *ngFor="let drag of dragHistory; let i = index">
              <small>{{ i + 1 }}. {{ drag.originalPin.title || 'Pin' }} moved to
                {{ drag.newCoordinates.latitude.toFixed(4) }}, {{ drag.newCoordinates.longitude.toFixed(4) }}
              </small>
            </div>
          </div>
        </div>

        <!-- Selections and Deletions -->
        <div class="info-panel">
          <h3>📍 Selections & Deletions</h3>
          <div class="info-content">
            <h4>Current Selections:</h4>
            <pre>{{ getSelectedLocationsInfo() }}</pre>
            <small class="multi-select-status">
              Multi-select: {{ isMultiSelectEnabled() ? 'ON' : 'OFF' }}
            </small>

            <h4>Recent Deletions:</h4>
            <pre>{{ getDeleteHistoryInfo() }}</pre>
            <div class="history-list" *ngFor="let deletion of deleteHistory; let i = index">
              <small>{{ i + 1 }}. {{ deletion.deletedPin.title || 'Pin' }} ({{ deletion.reason }})</small>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- Features Overview -->
    <section class="features">
      <h2>🚀 Features Demonstrated</h2>
      <div class="feature-grid">
        <div class="feature-card">
          <h3>�️ Multiple Map Layers</h3>
          <p>Switch between different map layers: Street, Satellite, Terrain, Dark, Light, Watercolor, and Toner themes</p>
        </div>
        <div class="feature-card">
          <h3>�📍 Draggable Pins</h3>
          <p>Some pins are draggable - try dragging the NYC, Google, and Tokyo pins!</p>
        </div>
        <div class="feature-card">
          <h3>🔍 Smart Search with Autocomplete</h3>
          <p>Built-in search control with autocomplete suggestions and external input binding</p>
        </div>
        <div class="feature-card">
          <h3>🖱️ Smart Selection System</h3>
          <p><strong>Single-Select Mode:</strong> Map clicks and search results are synced (both single selection)<br>
             <strong>Multi-Select Mode:</strong> Map clicks allow multiple selections, search results remain single</p>
        </div>
        <div class="feature-card">
          <h3>🗑️ Pin Management</h3>
          <p>Delete pins individually from tooltips, track deletion history, and manage selections programmatically</p>
        </div>
        <div class="feature-card">
          <h3>🎯 Smart Zoom</h3>
          <p>Automatically center and zoom to specific locations</p>
        </div>
        <div class="feature-card">
          <h3>🎨 Area Highlighting</h3>
          <p>Highlight areas with custom borders and fill colors (Times Square area shown)</p>
        </div>
        <div class="feature-card">
          <h3>🌍 Geocoding</h3>
          <p>Built-in address resolution using OpenStreetMap Nominatim API</p>
        </div>
        <div class="feature-card">
          <h3>⚡ Dynamic Updates</h3>
          <p>Add, remove, and update pins dynamically with event feedback</p>
        </div>
        <div class="feature-card">
          <h3>🎮 Full Control</h3>
          <p>Access to underlying Leaflet map instance for advanced customization</p>
        </div>
      </div>
    </section>

  </div>
</main>

<!-- Address Building Section -->
<section class="address-building-section">
  <div class="container">
    <h2>🏠 Address Building Demo</h2>
    <p>Build structured addresses using individual input fields, geocode them, and automatically display the results on a dedicated map with pins:</p>

    <div class="address-form">
      <h3>📝 Address Form</h3>
      <div class="address-inputs-grid">

        <!-- Address Line 1 -->
        <div class="input-group">
          <label for="addressLine1">Address Line 1:</label>
          <input
            type="text"
            id="addressLine1"
            [(ngModel)]="addressComponents.addressLine1"
            placeholder="Street number and name"
            class="address-input"
            (input)="onAddressComponentChange()">
        </div>

        <!-- Address Line 2 -->
        <div class="input-group">
          <label for="addressLine2">Address Line 2:</label>
          <input
            type="text"
            id="addressLine2"
            [(ngModel)]="addressComponents.addressLine2"
            placeholder="Apartment, suite, etc. (optional)"
            class="address-input"
            (input)="onAddressComponentChange()">
        </div>

        <!-- City -->
        <div class="input-group">
          <label for="city">City:</label>
          <input
            type="text"
            id="city"
            [(ngModel)]="addressComponents.city"
            placeholder="City name"
            class="address-input"
            (input)="onAddressComponentChange()">
        </div>

        <!-- State/Province -->
        <div class="input-group">
          <label for="state">State/Province:</label>
          <input
            type="text"
            id="state"
            [(ngModel)]="addressComponents.state"
            placeholder="State or province"
            class="address-input"
            (input)="onAddressComponentChange()">
        </div>

        <!-- Postal Code -->
        <div class="input-group">
          <label for="postalCode">ZIP/Postal Code:</label>
          <input
            type="text"
            id="postalCode"
            [(ngModel)]="addressComponents.postalCode"
            placeholder="ZIP or postal code"
            class="address-input"
            (input)="onAddressComponentChange()">
        </div>

        <!-- Country -->
        <div class="input-group">
          <label for="country">Country:</label>
          <select
            id="country"
            [(ngModel)]="addressComponents.country"
            class="address-input country-select"
            (change)="onAddressComponentChange()">
            <option value="">Select Country</option>
            <option value="United States">United States</option>
            <option value="Canada">Canada</option>
            <option value="United Kingdom">United Kingdom</option>
            <option value="Germany">Germany</option>
            <option value="France">France</option>
            <option value="Spain">Spain</option>
            <option value="Italy">Italy</option>
            <option value="Netherlands">Netherlands</option>
            <option value="Australia">Australia</option>
            <option value="Japan">Japan</option>
            <option value="South Korea">South Korea</option>
            <option value="India">India</option>
            <option value="China">China</option>
            <option value="Brazil">Brazil</option>
            <option value="Mexico">Mexico</option>
            <option value="Argentina">Argentina</option>
            <option value="South Africa">South Africa</option>
            <option value="Russia">Russia</option>
            <option value="Sweden">Sweden</option>
            <option value="Norway">Norway</option>
            <option value="Denmark">Denmark</option>
            <option value="Finland">Finland</option>
            <option value="Poland">Poland</option>
            <option value="Czech Republic">Czech Republic</option>
            <option value="Austria">Austria</option>
            <option value="Switzerland">Switzerland</option>
            <option value="Belgium">Belgium</option>
            <option value="Portugal">Portugal</option>
            <option value="Ireland">Ireland</option>
            <option value="New Zealand">New Zealand</option>
          </select>
        </div>
      </div>

      <!-- Built Address Display -->
      <div class="built-address-display">
        <h4>📍 Built Address:</h4>
        <div class="address-preview" [class.empty]="!getBuiltAddress()">
          {{ getBuiltAddress() || 'Fill in address fields to see the built address...' }}
        </div>
      </div>

      <!-- Address Actions -->
      <div class="address-actions">
        <button
          class="btn btn-primary"
          (click)="geocodeBuiltAddress()"
          [disabled]="!getBuiltAddress() || isGeocodingAddress">
          <span *ngIf="isGeocodingAddress">🔄 Geocoding...</span>
          <span *ngIf="!isGeocodingAddress">🗺️ Geocode & Show on Map</span>
        </button>

        <button
          class="btn btn-success"
          (click)="addBuiltAddressPin()"
          [disabled]="!builtAddressLocation">
          📍 Add Extra Pin
        </button>

        <button
          class="btn btn-secondary"
          (click)="clearAddressForm()">
          🧹 Clear Form
        </button>

        <button
          class="btn btn-info"
          (click)="fillSampleAddress()">
          📋 Sample Address
        </button>

        <button
          class="btn btn-warning"
          (click)="clearAddressPins()">
          🗑️ Clear All Pins
        </button>
      </div>

      <!-- Geocoding Status -->
      <div class="geocoding-status" *ngIf="addressGeocodingStatus">
        <div class="status-message" [ngClass]="addressGeocodingStatus.type">
          <strong>{{ addressGeocodingStatus.type === 'success' ? '✅' : '❌' }}</strong>
          {{ addressGeocodingStatus.message }}
        </div>
        <div class="geocoded-info" *ngIf="builtAddressLocation">
          <p><strong>📍 Coordinates:</strong> {{ builtAddressLocation.latitude?.toFixed(6) }}, {{ builtAddressLocation.longitude?.toFixed(6) }}</p>
          <p><strong>📋 Built Address:</strong> {{ getBuiltAddress() }}</p>
        </div>
      </div>
    </div>

    <!-- Address Map -->
    <div class="address-map-section">
      <h3>🗺️ Address Map</h3>
      <p>This dedicated map shows the geocoded addresses from the address building form:</p>

      <ng-osm-map
        #addressMapComponent
        [mapId]="addressMapId"
        [zoomInto]="addressMapCenter"
        [mapOptions]="addressMapOptions"
        [height]="350"
        [width]="'100%'"
        (mapClick)="onAddressMapClick($event)"
        (locationSelected)="onAddressMapLocationSelected($event)"
        (pinDeleted)="onAddressMapPinDeleted($event)"
        [searchLocation]="searchLocation"
        class="address-map-container">
      </ng-osm-map>

      <div class="address-map-info">
        <p><strong>Address Pins:</strong> {{ addressPins.length }}</p>
        <p *ngIf="addressPins.length > 0"><strong>Latest Address:</strong> {{ getLatestAddressPin()?.title || 'N/A' }}</p>
      </div>
    </div>

    <!-- Sample Address Patterns -->
    <div class="sample-addresses">
      <h3>📋 Sample Address Patterns</h3>
      <p>Click on any sample to automatically fill the address form:</p>
      <div class="sample-grid">

        <div class="sample-card" (click)="fillSampleAddress('us')">
          <h4>🇺🇸 United States</h4>
          <div class="sample-address">
            <div>123 Main Street</div>
            <div>Apt 4B</div>
            <div>New York, NY 10001</div>
            <div>United States</div>
          </div>
        </div>

        <div class="sample-card" (click)="fillSampleAddress('uk')">
          <h4>🇬🇧 United Kingdom</h4>
          <div class="sample-address">
            <div>10 Downing Street</div>
            <div>Westminster</div>
            <div>London SW1A 2AA</div>
            <div>United Kingdom</div>
          </div>
        </div>

        <div class="sample-card" (click)="fillSampleAddress('ca')">
          <h4>🇨🇦 Canada</h4>
          <div class="sample-address">
            <div>24 Sussex Drive</div>
            <div></div>
            <div>Ottawa, ON K1M 1M4</div>
            <div>Canada</div>
          </div>
        </div>

        <div class="sample-card" (click)="fillSampleAddress('de')">
          <h4>🇩🇪 Germany</h4>
          <div class="sample-address">
            <div>Unter den Linden 77</div>
            <div></div>
            <div>Berlin 10117</div>
            <div>Germany</div>
          </div>
        </div>

        <div class="sample-card" (click)="fillSampleAddress('jp')">
          <h4>🇯🇵 Japan</h4>
          <div class="sample-address">
            <div>1-1 Chiyoda</div>
            <div></div>
            <div>Tokyo 100-8111</div>
            <div>Japan</div>
          </div>
        </div>

        <div class="sample-card" (click)="fillSampleAddress('au')">
          <h4>🇦🇺 Australia</h4>
          <div class="sample-address">
            <div>1 Macquarie Street</div>
            <div></div>
            <div>Sydney NSW 2000</div>
            <div>Australia</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Address Building Tips -->
    <div class="address-examples">
      <h3>💡 Address Building Tips</h3>
      <div class="tips-grid">
        <div class="tip-card">
          <h4>🎯 Complete Addresses</h4>
          <p>Include as many address components as possible for better geocoding accuracy. Street number, street name, city, and country are most important for precise location mapping.</p>
        </div>
        <div class="tip-card">
          <h4>🌍 International Support</h4>
          <p>The geocoding service supports international addresses. When you click "Geocode & Show on Map", the location is automatically pinned and selected on the map.</p>
        </div>
        <div class="tip-card">
          <h4>🔍 Fallback Options</h4>
          <p>If a full address doesn't geocode, try with just "City, Country" or "State, Country" for broader location results. The system will show helpful error messages.</p>
        </div>
        <div class="tip-card">
          <h4>📱 Automatic Mapping</h4>
          <p>The geocoding process automatically creates pins and centers the map on found locations. Use "Add Extra Pin" for additional markers at the same location.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Template-based Popup Features -->
<section class="template-features">
  <div class="container">
    <h2>🧩 Template-based Pin Popups</h2>
    <div class="feature-description">
      <p>
        The library now supports custom Angular templates for pin popups! This allows you to:
      </p>
      <ul class="feature-list">
        <li>🎨 Create rich, interactive popup content with full Angular features</li>
        <li>📦 Pass location object, pin data, and pin index to your template</li>
        <li>🗑️ Implement custom delete functionality with a provided callback</li>
        <li>💡 Use Angular directives, pipes, and components within popups</li>
      </ul>
      <p class="template-demo-note">
        <strong>🌟 Try it out:</strong> Look for the <span class="highlight">London</span> and
        <span class="highlight">Berlin</span> pins on the map - they use custom templates with
        rich content and interactive features!
      </p>
    </div>
  </div>
</section>

<!-- Template definitions for custom pin popups -->
<ng-template #customPopupTemplate let-location let-pin="pin" let-pinIndex="pinIndex">
  <div class="custom-popup">
    <div class="popup-header">
      <h3>🌟 {{ pin.title }}</h3>
      <span class="coordinates">{{ location.latitude?.toFixed(4) }}, {{ location.longitude?.toFixed(4) }}</span>
    </div>

    <div class="popup-content">
      <div class="city-info" *ngIf="pin.data?.cityInfo">
        <div class="info-item">
          <strong>👥 Population:</strong> {{ pin.data.cityInfo.population }}
        </div>
        <div class="info-item">
          <strong>📅 Established:</strong> {{ pin.data.cityInfo.established }}
        </div>
        <div class="info-item">
          <strong>🏛️ Famous Landmarks:</strong>
          <ul class="landmarks-list">
            <li *ngFor="let landmark of pin.data.cityInfo.landmarks">{{ landmark }}</li>
          </ul>
        </div>
      </div>

      <div class="popup-actions">
        <small class="pin-info">Pin #{{ pinIndex }} • {{ pin.draggable ? 'Draggable' : 'Fixed' }}</small>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #deleteablePopupTemplate let-location let-pin="pin" let-pinIndex="pinIndex" let-deletePin="deletePin">
  <div class="deleteable-popup">
    <div class="popup-header">
      <h3>🗑️ {{ pin.title }}</h3>
      <button class="close-btn" onclick="this.closest('.leaflet-popup').querySelector('.leaflet-popup-close-button').click()">&times;</button>
    </div>

    <div class="popup-content">
      <div class="location-info">
        <p><strong>📍 Location:</strong> {{ location.latitude?.toFixed(6) }}, {{ location.longitude?.toFixed(6) }}</p>
        <p><strong>🎨 Color:</strong> <span class="color-preview" [style.background-color]="pin.color">{{ pin.color }}</span></p>
      </div>

      <div class="city-info" *ngIf="pin.data?.cityInfo">
        <div class="info-grid">
          <div class="info-card">
            <div class="info-label">Population</div>
            <div class="info-value">{{ pin.data.cityInfo.population }}</div>
          </div>
          <div class="info-card">
            <div class="info-label">Founded</div>
            <div class="info-value">{{ pin.data.cityInfo.established }}</div>
          </div>
        </div>

        <div class="landmarks-section">
          <h4>Famous Landmarks:</h4>
          <div class="landmarks-tags">
            <span class="landmark-tag" *ngFor="let landmark of pin.data.cityInfo.landmarks">
              {{ landmark }}
            </span>
          </div>
        </div>
      </div>

      <div class="popup-actions">
        <button class="btn-delete" (click)="deletePin()">
          🗑️ Delete This Pin
        </button>
        <small class="pin-info">Template-based popup with custom delete action</small>
      </div>
    </div>
  </div>
</ng-template>

<!-- Custom Autocomplete Template -->
<ng-template #customAutocompleteTemplate let-suggestions let-query="query" let-selectSuggestion="selectSuggestion" let-loading="loading">
  <div class="custom-autocomplete-dropdown" *ngIf="suggestions.length > 0 || loading">
    <div *ngIf="loading" class="loading-item">
      <div class="spinner"></div>
      <span>Searching...</span>
    </div>
    <div *ngFor="let suggestion of suggestions"
         class="custom-suggestion-item"
         (click)="selectSuggestion(suggestion)">
      <div class="suggestion-main">{{ suggestion.displayText }}</div>
      <div class="suggestion-details">{{ suggestion.fullDisplayName }}</div>
      <div class="suggestion-coords">
        {{ suggestion.coordinates.latitude.toFixed(4) }}, {{ suggestion.coordinates.longitude.toFixed(4) }}
      </div>
    </div>
  </div>
</ng-template>

<footer class="footer">
  <div class="container">
    <p>&copy; 2025 NgOsmMap Library - Built with Angular 18 & Leaflet</p>
    <p>
      <a href="https://www.openstreetmap.org/copyright" target="_blank">
        © OpenStreetMap contributors
      </a> |
      <a href="https://leafletjs.com/" target="_blank">
        Powered by Leaflet
      </a>
    </p>
  </div>
</footer>

